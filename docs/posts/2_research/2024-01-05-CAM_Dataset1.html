<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.527">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="SEOYEON CHOI">
<meta name="dcterms.date" content="2024-01-05">

<title>HCAM blog - [CAM]Dataset1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">HCAM blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://seoyeonc.github.io/sy_hub/"> 
<span class="menu-text">Main_Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/seoyeonc"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">[CAM]Dataset1</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">[CAM]Dataset1</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>SEOYEON CHOI </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 5, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../1_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Studies</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text"><strong>Research</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Research</strong></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text"><strong>Result</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3_figure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Figure</strong></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#import" id="toc-import" class="nav-link active" data-scroll-target="#import">Import</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#step" id="toc-step" class="nav-link" data-scroll-target="#step">Step</a>
  <ul class="collapse">
  <li><a href="#mode-1" id="toc-mode-1" class="nav-link" data-scroll-target="#mode-1">mode 1</a></li>
  <li><a href="#mode-3-만들기" id="toc-mode-3-만들기" class="nav-link" data-scroll-target="#mode-3-만들기">mode 3 만들기</a></li>
  </ul></li>
  <li><a href="#other-methods" id="toc-other-methods" class="nav-link" data-scroll-target="#other-methods">Other Methods</a>
  <ul class="collapse">
  <li><a href="#시도" id="toc-시도" class="nav-link" data-scroll-target="#시도">시도</a></li>
  </ul></li>
  <li><a href="#randombox-image-download" id="toc-randombox-image-download" class="nav-link" data-scroll-target="#randombox-image-download">randombox Image download</a></li>
  <li><a href="#randombox" id="toc-randombox" class="nav-link" data-scroll-target="#randombox">randombox</a></li>
  <li><a href="#step-by-step" id="toc-step-by-step" class="nav-link" data-scroll-target="#step-by-step">Step by step</a>
  <ul class="collapse">
  <li><a href="#mode-1-1" id="toc-mode-1-1" class="nav-link" data-scroll-target="#mode-1-1">mode 1</a></li>
  <li><a href="#mode-3-만들기-1" id="toc-mode-3-만들기-1" class="nav-link" data-scroll-target="#mode-3-만들기-1">mode 3 만들기</a></li>
  </ul></li>
  <li><a href="#randombox-other-methods" id="toc-randombox-other-methods" class="nav-link" data-scroll-target="#randombox-other-methods">Randombox Other Methods</a></li>
  <li><a href="#gradcam" id="toc-gradcam" class="nav-link" data-scroll-target="#gradcam">GradCAM</a></li>
  <li><a href="#hirescam" id="toc-hirescam" class="nav-link" data-scroll-target="#hirescam">HiResCAM</a></li>
  <li><a href="#scorecam" id="toc-scorecam" class="nav-link" data-scroll-target="#scorecam">ScoreCAM</a></li>
  <li><a href="#gradcamplusplus" id="toc-gradcamplusplus" class="nav-link" data-scroll-target="#gradcamplusplus">GradCAMPlusPlus</a></li>
  <li><a href="#ablationcam" id="toc-ablationcam" class="nav-link" data-scroll-target="#ablationcam">AblationCAM</a></li>
  <li><a href="#xgradcam" id="toc-xgradcam" class="nav-link" data-scroll-target="#xgradcam">XGradCAM</a></li>
  <li><a href="#eigencam" id="toc-eigencam" class="nav-link" data-scroll-target="#eigencam">EigenCAM</a></li>
  <li><a href="#fullgrad" id="toc-fullgrad" class="nav-link" data-scroll-target="#fullgrad">FullGrad</a></li>
  <li><a href="#eigengradcam" id="toc-eigengradcam" class="nav-link" data-scroll-target="#eigengradcam">EigenGradCAM</a></li>
  <li><a href="#layercam" id="toc-layercam" class="nav-link" data-scroll-target="#layercam">LayerCAM</a>
  <ul class="collapse">
  <li><a href="#figure_randombox" id="toc-figure_randombox" class="nav-link" data-scroll-target="#figure_randombox">Figure_Randombox</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>https://docs.fast.ai/data.external.html</p>
<section id="import" class="level1">
<h1>Import</h1>
<div id="f40692e7-f1d4-47a5-99bb-0ff50e2fc232" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytorch_grad_cam <span class="im">import</span> GradCAM, HiResCAM, ScoreCAM, GradCAMPlusPlus, AblationCAM, XGradCAM, EigenCAM, FullGrad, EigenGradCAM, LayerCAM</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytorch_grad_cam.utils.model_targets <span class="im">import</span> ClassifierOutputTarget</span></code></pre></div>
</div>
<div id="7d9dd882-1a75-44a7-a94a-07c54ffaa8a0" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span></code></pre></div>
</div>
<div id="2878a490-25c4-4974-808b-fc7f67c7c066" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div>
</div>
<div id="52ae016b-9f50-4f73-b39e-9cd13a1d151a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'CUDA_LAUNCH_BLOCKING'</span>] <span class="op">=</span> <span class="st">"1"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"CUDA_VISIBLE_DEVICES"</span>] <span class="op">=</span> <span class="st">"0"</span></span></code></pre></div>
</div>
<div id="e1135dd9-fc9a-4914-86c1-d261b2b4afd9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> ImageDraw</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> ImageFont</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> ImageFile</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>ImageFile.LOAD_TRUNCATED_IMAGES <span class="op">=</span> <span class="va">True</span></span></code></pre></div>
</div>
<div id="1bb8fcca-593a-49f3-aa18-61a55059d794" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchvision <span class="im">import</span> <span class="op">*</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code></pre></div>
</div>
<div id="6ace95a9-9272-4400-a24d-6a3c51b63d22" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpy2</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpy2.robjects <span class="im">as</span> ro </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.vectors <span class="im">import</span> FloatVector </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.packages <span class="im">import</span> importr</span></code></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<div id="d39bbfab-53e1-4b32-ab74-dea6dba13d9a" class="cell" data-execution_count="862">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> untar_data(URLs.CALTECH_101)<span class="op">;</span>path</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="862">
<pre><code>Path('/home/csy/.fastai/data/caltech_101')</code></pre>
</div>
</div>
<div id="e386e34d-b8ef-4c12-943c-601519c2f8e5" class="cell" data-execution_count="863">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>path.ls()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="863">
<pre><code>(#102) [Path('/home/csy/.fastai/data/caltech_101/gerenuk'),Path('/home/csy/.fastai/data/caltech_101/ceiling_fan'),Path('/home/csy/.fastai/data/caltech_101/electric_guitar'),Path('/home/csy/.fastai/data/caltech_101/schooner'),Path('/home/csy/.fastai/data/caltech_101/sunflower'),Path('/home/csy/.fastai/data/caltech_101/brain'),Path('/home/csy/.fastai/data/caltech_101/dolphin'),Path('/home/csy/.fastai/data/caltech_101/nautilus'),Path('/home/csy/.fastai/data/caltech_101/panda'),Path('/home/csy/.fastai/data/caltech_101/chair')...]</code></pre>
</div>
</div>
<div id="375f4650-9707-4fcc-b4cc-52aa510d55d9" class="cell" data-execution_count="864">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, seed<span class="op">=</span><span class="dv">42</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">512</span>), </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                   batch_tfms<span class="op">=</span>[<span class="op">*</span>aug_transforms(), Normalize.from_stats(<span class="op">*</span>imagenet_stats)])</span></code></pre></div>
</div>
<div id="b58433f4-cbd7-4456-a7fb-e0188ecd6f45" class="cell" data-execution_count="865">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dls.show_batch()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="98f77275-01e7-432c-bffb-6fa44abcd0a5" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lrnr<span class="op">=</span>cnn_learner(dls,resnet34,metrics<span class="op">=</span>error_rate)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>lrnr.fine_tune(<span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/csy/anaconda3/envs/temp_csy/lib/python3.8/site-packages/fastai/vision/learner.py:288: UserWarning: `cnn_learner` has been renamed to `vision_learner` -- please update your code
  warn("`cnn_learner` has been renamed to `vision_learner` -- please update your code")
/home/csy/anaconda3/envs/temp_csy/lib/python3.8/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/home/csy/anaconda3/envs/temp_csy/lib/python3.8/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet34_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet34_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>2.786667</td>
<td>1.086679</td>
<td>0.280635</td>
<td>00:46</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.953599</td>
<td>0.546696</td>
<td>0.141685</td>
<td>00:59</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ad8f7d89-e8b2-4e15-ba68-109ff847113c" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>net1<span class="op">=</span>lrnr.model[<span class="dv">0</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>net2<span class="op">=</span>lrnr.model[<span class="dv">1</span>] </span></code></pre></div>
</div>
<div id="a3f3b5d7-9528-4838-b5c4-654e0e1a691e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>net2</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Sequential(
  (0): AdaptiveConcatPool2d(
    (ap): AdaptiveAvgPool2d(output_size=1)
    (mp): AdaptiveMaxPool2d(output_size=1)
  )
  (1): fastai.layers.Flatten(full=False)
  (2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (3): Dropout(p=0.25, inplace=False)
  (4): Linear(in_features=1024, out_features=512, bias=False)
  (5): ReLU(inplace=True)
  (6): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (7): Dropout(p=0.5, inplace=False)
  (8): Linear(in_features=512, out_features=102, bias=False)
)</code></pre>
</div>
</div>
<div id="d3c21ded-3ada-44ab-8511-b7d28a4dae1a" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>net2 <span class="op">=</span> torch.nn.Sequential(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    torch.nn.AdaptiveAvgPool2d(output_size<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    torch.nn.Flatten(),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    torch.nn.Linear(<span class="dv">512</span>,out_features<span class="op">=</span><span class="dv">102</span>,bias<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
</div>
<div id="5662169f-392a-42fd-a90b-0b30e35ee135" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>net<span class="op">=</span>torch.nn.Sequential(net1,net2)</span></code></pre></div>
</div>
<div id="aefdb295-ed4f-4128-b7fd-3d75b4064f3c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lrnr2<span class="op">=</span>Learner(dls,net,metrics<span class="op">=</span>accuracy) </span></code></pre></div>
</div>
<div id="4f62af6b-4f32-4f04-97ae-ea0014d103ce" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lrnr2.fine_tune(<span class="dv">5</span>) </span></code></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>2.200760</td>
<td>3.150540</td>
<td>0.371444</td>
<td>00:59</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.145681</td>
<td>1.464551</td>
<td>0.653173</td>
<td>00:59</td>
</tr>
<tr class="even">
<td>1</td>
<td>1.119536</td>
<td>1.774413</td>
<td>0.589716</td>
<td>00:58</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.751984</td>
<td>0.828347</td>
<td>0.771335</td>
<td>00:59</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.415494</td>
<td>0.496882</td>
<td>0.862144</td>
<td>00:59</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.232705</td>
<td>0.418902</td>
<td>0.882385</td>
<td>00:59</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="step" class="level1">
<h1>Step</h1>
<div id="3ef608ce-9e14-4b5a-9093-227370e3f2ed" class="cell" data-execution_count="866">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x, <span class="op">=</span> first(dls.test_dl([PILImage.create(get_image_files(path)[<span class="dv">20</span>])]))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="b7be80b8-3c3e-4917-80ec-ea103469e109" class="cell" data-execution_count="868">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x.to(<span class="st">'cpu'</span>)</span></code></pre></div>
</div>
<div id="768291e7-bd6a-4a94-8d0e-b66db21b37bf" class="cell" data-execution_count="869">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>camimg <span class="op">=</span> torch.einsum(<span class="st">'ij,jkl -&gt; ikl'</span>, net2[<span class="dv">2</span>].weight, net1(x).squeeze())</span></code></pre></div>
</div>
<div id="3ae7ebcb-ba54-429e-88d6-d2bf03796415" class="cell" data-execution_count="870">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ebayesthresh <span class="op">=</span> importr(<span class="st">'EbayesThresh'</span>).ebayesthresh</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>power_threshed<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ybar_threshed <span class="op">=</span> np.where(power_threshed<span class="op">&gt;</span><span class="dv">80</span>,torch.tensor(camimg[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)).cpu(),<span class="dv">0</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ybar_threshed <span class="op">=</span> torch.tensor(ybar_threshed.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>power_threshed2<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ybar_threshed2 <span class="op">=</span> np.where(power_threshed2<span class="op">&gt;</span><span class="dv">80</span>,torch.tensor(camimg[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)).cpu(),<span class="dv">0</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ybar_threshed2 <span class="op">=</span> torch.tensor(ybar_threshed2.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed=np.array(ebayesthresh(FloatVector(torch.tensor(camimg[0].detach().reshape(-1))**2)))
&lt;ipython-input-870-11d406c6ed63&gt;:4: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed = np.where(power_threshed&gt;80,torch.tensor(camimg[0].detach().reshape(-1)).cpu(),0)
&lt;ipython-input-870-11d406c6ed63&gt;:7: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed2=np.array(ebayesthresh(FloatVector(torch.tensor(camimg[1].detach().reshape(-1))**2)))
&lt;ipython-input-870-11d406c6ed63&gt;:8: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed2 = np.where(power_threshed2&gt;80,torch.tensor(camimg[1].detach().reshape(-1)).cpu(),0)</code></pre>
</div>
</div>
<div id="d83f9d17-fd44-440f-ab5d-43042a6aa4a2" class="cell" data-execution_count="871">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2,ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>) </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Input image"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow((ybar_threshed).to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dv">48</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ax2.set_title("CAT PART")</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax3)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>ax3.imshow((ybar_threshed2).to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dv">48</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ax3.set_title("DOG PART")</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">12</span>)            </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">12</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>판단 근거가 강할 수록 파란색 -&gt; 보라색</li>
</ul>
<section id="mode-1" class="level2">
<h2 class="anchored" data-anchor-id="mode-1">mode 1</h2>
<div id="6149f721-48ee-47e2-83d9-2dd510bafe2e" class="cell" data-execution_count="872">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test=camimg_o[0]-torch.min(camimg_o[0])</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>A1<span class="op">=</span>torch.exp(<span class="op">-</span><span class="fl">0.05</span><span class="op">*</span>(ybar_threshed))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> A1</span></code></pre></div>
</div>
<div id="4a4aef38-9ea8-482a-89ef-7152fe0462d4" class="cell" data-execution_count="873">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(A2.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1 WEIGHTT"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(A1.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES WEIGHT"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e34c3868-cc95-42ce-bfee-aa4141e12f83" class="cell" data-execution_count="874">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mode 1 res</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>np.array(A1.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>Y1<span class="op">=</span>torch.Tensor(cv2.resize(X1,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>x1<span class="op">=</span>x.squeeze().to(<span class="st">'cpu'</span>)<span class="op">*</span>Y1<span class="op">-</span>torch.<span class="bu">min</span>(x.squeeze().to(<span class="st">'cpu'</span>))<span class="op">*</span>Y1</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mode 1</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>X12<span class="op">=</span>np.array(A2.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>Y12<span class="op">=</span>torch.Tensor(cv2.resize(X12,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>x12<span class="op">=</span>x.squeeze().to(<span class="st">'cpu'</span>)<span class="op">*</span>Y12<span class="op">-</span>torch.<span class="bu">min</span>(x.squeeze().to(<span class="st">'cpu'</span>))<span class="op">*</span>Y12</span></code></pre></div>
</div>
<p><code>-</code> 1st CAM 분리</p>
<div id="ce5d01ce-08f1-485d-a91f-b2b9a93999d1" class="cell" data-execution_count="896">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"ORIGINAL"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">4</span>)            </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">4</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x12<span class="op">*</span><span class="fl">0.3</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.1</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE1_res</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-28-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-28-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="5ccc264e-4140-4a4f-bae5-2895ae69a073" class="cell" data-execution_count="897">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> x1.reshape(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">512</span>,<span class="dv">512</span>)</span></code></pre></div>
</div>
<div id="ed6f2043-7caf-4c9c-8d1e-a87316f0b333" class="cell" data-execution_count="898">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>net1.to(<span class="st">'cpu'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>net2.to(<span class="st">'cpu'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="898">
<pre><code>Sequential(
  (0): AdaptiveAvgPool2d(output_size=1)
  (1): Flatten(start_dim=1, end_dim=-1)
  (2): Linear(in_features=512, out_features=102, bias=False)
)</code></pre>
</div>
</div>
<div id="d0a879f7-888b-40e5-83e4-065e586a188e" class="cell" data-execution_count="899">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>camimg1 <span class="op">=</span> torch.einsum(<span class="st">'ij,jkl -&gt; ikl'</span>, net2[<span class="dv">2</span>].weight, net1(x1).squeeze())</span></code></pre></div>
</div>
<div id="71f2c7bf-ed29-4406-9cbc-f34dec3cf615" class="cell" data-execution_count="900">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>power_threshed3<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg1[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ybar_threshed3 <span class="op">=</span> np.where(power_threshed3<span class="op">&gt;</span><span class="dv">10</span>,torch.tensor(camimg1[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>ybar_threshed3 <span class="op">=</span> torch.tensor(ybar_threshed3.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>power_threshed4<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg1[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>ybar_threshed4 <span class="op">=</span> np.where(power_threshed4<span class="op">&gt;</span><span class="dv">10</span>,torch.tensor(camimg1[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>ybar_threshed4 <span class="op">=</span> torch.tensor(ybar_threshed4.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed3=np.array(ebayesthresh(FloatVector(torch.tensor(camimg1[0].detach().reshape(-1))**2)))
&lt;ipython-input-900-292f842a7fbc&gt;:2: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed3 = np.where(power_threshed3&gt;10,torch.tensor(camimg1[0].detach().reshape(-1)),0)
&lt;ipython-input-900-292f842a7fbc&gt;:5: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed4=np.array(ebayesthresh(FloatVector(torch.tensor(camimg1[1].detach().reshape(-1))**2)))
&lt;ipython-input-900-292f842a7fbc&gt;:6: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed4 = np.where(power_threshed4&gt;10,torch.tensor(camimg1[1].detach().reshape(-1)),0)</code></pre>
</div>
</div>
<p><code>-</code> mode1 res</p>
<div id="4884a0c3-d0bb-4469-9f32-7b7c4aabd1b8" class="cell" data-execution_count="901">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.25</span>).squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed3,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"CAT PART"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.25</span>).squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed4,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DOG PART"</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-33-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><code>-</code> 첫번째 CAM 결과와 비교</p>
<div id="045ab66e-af78-4a45-96a7-80fcb83a9427" class="cell" data-execution_count="902">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"1ST CAM"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed3,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"2ND CAM"</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><code>-</code> 2nd CAM 분리</p>
<div id="2707fbe2-65e4-4f3f-b281-85c3a11361ce" class="cell" data-execution_count="903">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test1=camimg1[0]-torch.min(camimg1[0])</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>A3 <span class="op">=</span> torch.exp(<span class="op">-</span><span class="fl">0.05</span><span class="op">*</span>(ybar_threshed3))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>A4 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> A3</span></code></pre></div>
</div>
<div id="e38d048d-7c8d-451c-838d-11be0f5e8fe6" class="cell" data-execution_count="904">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>x1.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x1,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>ax1.imshow(A3.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE2 RES WEIGHT"</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>x1.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x1,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>ax2.imshow(A4.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE2 WEIGHT"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-36-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="55d2ec2e-4aac-486c-a69e-20988c7e645d" class="cell" data-execution_count="905">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>X2<span class="op">=</span>np.array(A3.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Y2<span class="op">=</span>torch.Tensor(cv2.resize(X2,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>x2<span class="op">=</span>(x1)<span class="op">*</span>Y2<span class="op">-</span>torch.<span class="bu">min</span>((x1)<span class="op">*</span>Y2)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>X22<span class="op">=</span>np.array(A4.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>Y22<span class="op">=</span>torch.Tensor(cv2.resize(X22,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>x22<span class="op">=</span>(x1)<span class="op">*</span>Y22<span class="op">-</span>torch.<span class="bu">min</span>((x1)<span class="op">*</span>Y22)</span></code></pre></div>
</div>
<div id="0f711715-6cb3-43aa-881f-8aa8bb9c4e15" class="cell" data-execution_count="915">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"ORIGINAL"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">4</span>)            </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">4</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x12<span class="op">*</span><span class="fl">0.3</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.1</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE1_res</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES"</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x22<span class="op">+</span><span class="fl">1.7</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE2</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>(x2<span class="op">*</span><span class="fl">0.1</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE2_res</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE2"</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE2 RES"</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-38-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-38-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-38-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f094e3fe-d593-43f9-ab3c-33da0b0d6ec8" class="cell" data-execution_count="916">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> x2.reshape(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">512</span>,<span class="dv">512</span>)</span></code></pre></div>
</div>
<div id="44f5710d-52d5-407f-86ef-2d414b92777b" class="cell" data-execution_count="917">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>net1.to(<span class="st">'cpu'</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>net2.to(<span class="st">'cpu'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="917">
<pre><code>Sequential(
  (0): AdaptiveAvgPool2d(output_size=1)
  (1): Flatten(start_dim=1, end_dim=-1)
  (2): Linear(in_features=512, out_features=102, bias=False)
)</code></pre>
</div>
</div>
<div id="517c3c17-0d6c-48ac-a54f-95c564e14c06" class="cell" data-execution_count="918">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>camimg2 <span class="op">=</span> torch.einsum(<span class="st">'ij,jkl -&gt; ikl'</span>, net2[<span class="dv">2</span>].weight, net1(x2).squeeze())</span></code></pre></div>
</div>
<div id="ee0f4595-0d6e-46d5-9d90-590570214674" class="cell" data-execution_count="919">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>power_threshed5<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg2[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ybar_threshed5 <span class="op">=</span> np.where(power_threshed5<span class="op">&gt;</span><span class="dv">40</span>,torch.tensor(camimg2[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ybar_threshed5 <span class="op">=</span> torch.tensor(ybar_threshed5.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>power_threshed6<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg2[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>ybar_threshed6 <span class="op">=</span> np.where(power_threshed6<span class="op">&gt;</span><span class="dv">40</span>,torch.tensor(camimg2[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>ybar_threshed6 <span class="op">=</span> torch.tensor(ybar_threshed6.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed5=np.array(ebayesthresh(FloatVector(torch.tensor(camimg2[0].detach().reshape(-1))**2)))
&lt;ipython-input-919-ba6e482cf5c4&gt;:2: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed5 = np.where(power_threshed5&gt;40,torch.tensor(camimg2[0].detach().reshape(-1)),0)
&lt;ipython-input-919-ba6e482cf5c4&gt;:5: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed6=np.array(ebayesthresh(FloatVector(torch.tensor(camimg2[1].detach().reshape(-1))**2)))
&lt;ipython-input-919-ba6e482cf5c4&gt;:6: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed6 = np.where(power_threshed6&gt;40,torch.tensor(camimg2[1].detach().reshape(-1)),0)</code></pre>
</div>
</div>
<p><code>-</code> mode2 res 에 CAM 결과 올리기</p>
<div id="491d57dc-0a90-496e-a15e-ca6332fef608" class="cell" data-execution_count="920">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed5,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"CAT PART"</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed6,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DOG PART"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-43-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a5e70686-f07b-470a-9dff-24e91c3b9cf0" class="cell" data-execution_count="921">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2,ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>) </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"1ST CAM"</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed3,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"2ND CAM"</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax3)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>ax3.imshow(ybar_threshed5,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"3RD CAM"</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">12</span>)            </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">12</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mode-3-만들기" class="level2">
<h2 class="anchored" data-anchor-id="mode-3-만들기">mode 3 만들기</h2>
<div id="999baebd-0818-48b4-826b-e4ebb72a6afb" class="cell" data-execution_count="922">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test2=camimg2[0]-torch.min(camimg2[0])</span></span></code></pre></div>
</div>
<div id="3e9b28dd-6dc4-4b6e-8196-16650c09dfd5" class="cell" data-execution_count="923">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>A5 <span class="op">=</span> torch.exp(<span class="op">-</span><span class="fl">0.05</span><span class="op">*</span>(ybar_threshed5))</span></code></pre></div>
</div>
<div id="da9ed004-1034-4d4d-90f8-002d5799666c" class="cell" data-execution_count="924">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>A6 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> A5</span></code></pre></div>
</div>
<div id="ec9781fd-d8c9-4ebd-a805-9edd5e2cb269" class="cell" data-execution_count="925">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed5,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"CAT PART"</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed6,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DOG PART"</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-48-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="17c3f3b7-1a0f-40b8-821a-57b5ccc360f7" class="cell" data-execution_count="926">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mode 3 res</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>X3<span class="op">=</span>np.array(A5.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>Y3<span class="op">=</span>torch.Tensor(cv2.resize(X3,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>x2<span class="op">*</span>Y3<span class="op">-</span>torch.<span class="bu">min</span>(x2<span class="op">*</span>Y3)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mode 3</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>X32<span class="op">=</span>np.array(A6.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>Y32<span class="op">=</span>torch.Tensor(cv2.resize(X32,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>x32<span class="op">=</span>x2<span class="op">*</span>Y32<span class="op">-</span>torch.<span class="bu">min</span>(x2<span class="op">*</span>Y32)</span></code></pre></div>
</div>
<div id="75e944ad-80cb-48ac-8b59-ca01f2787329" class="cell" data-execution_count="927">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span></code></pre></div>
</div>
<div id="fc9411de-0ae1-4cac-b781-b2d71e70ec32" class="cell" data-execution_count="932">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"ORIGINAL"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">4</span>)            </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">4</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt1.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x12<span class="op">*</span><span class="fl">0.3</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.1</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE1_res</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES"</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt2.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x22<span class="op">+</span><span class="fl">1.7</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE2</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>(x2<span class="op">*</span><span class="fl">0.1</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE2_res</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE2"</span>)</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE2 RES"</span>)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt3.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x32<span class="op">+</span><span class="dv">2</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE3</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>(x3<span class="op">*</span><span class="fl">0.1</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE3_res</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE3"</span>)</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE3 RES"</span>)</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt4.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-51-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-51-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-51-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-51-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="0a310ade-8524-4d0c-b4b6-69be588ac6fa" class="cell" data-execution_count="933">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="39316035-e077-4b19-9aa8-7163056f8939" class="cell" data-execution_count="934">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt2.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="13aa9301-6a73-450f-8600-6dbed7519795" class="cell" data-execution_count="935">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt3.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a9b31fd5-3ed4-4633-9a7c-8dc18e0eb6b1" class="cell" data-execution_count="936">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt4.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="936060e2-166b-43bb-94e1-061af8d7be4e" class="cell" data-execution_count="937">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">0.3</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt_mode1.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-56-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9b63a6ed-eb7f-428a-b9eb-26c6ba3b5b52" class="cell" data-execution_count="938">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt_mode1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt_mode1 <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt_mode1)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="5b32160b-2ff1-4687-b127-435b13d3b5c1" class="cell" data-execution_count="939">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x12<span class="op">*</span><span class="fl">0.3</span> <span class="op">+</span> <span class="op">-</span>x22<span class="op">+</span><span class="fl">1.7</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1+MODE2</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1+MODE2"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt_mode2.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-58-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="63eeae01-7df5-474c-8730-554209d9f5b0" class="cell" data-execution_count="940">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt_mode2.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt_mode2 <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt_mode2)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-59-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="02512b23-442f-4188-905d-c4f6cfdbd273" class="cell" data-execution_count="942">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">0.3</span> <span class="op">+</span> <span class="op">-</span>x22<span class="op">+</span><span class="fl">1.7</span> <span class="op">+</span> <span class="op">-</span>x32<span class="op">+</span><span class="dv">2</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1+MODE2+MODE3</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1+MODE2+MODE3"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt_mode3.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-60-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="adc808ad-c020-450a-bc9d-655e7d0b3d10" class="cell" data-execution_count="943">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_hcam_cat_plt_mode3.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt_mode3 <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt_mode3)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-61-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="other-methods" class="level1">
<h1>Other Methods</h1>
<div id="33ef9b04-7e16-4507-b4f4-88e6559e82eb" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>gradcam <span class="op">=</span> GradCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/csy/anaconda3/envs/temp_csy/lib/python3.8/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/home/csy/anaconda3/envs/temp_csy/lib/python3.8/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet34_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet34_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)</code></pre>
</div>
</div>
<div id="174cdd97-c4bc-4307-a7b8-f182683ca9c7" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>hirescam <span class="op">=</span> HiResCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="47cab7c2-42ac-4c83-a4f8-01a63bc768f5" class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>scorecam <span class="op">=</span> ScoreCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="a2971b53-a5c3-49d0-aee8-2c0db85bc95f" class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>gradcamplusplus <span class="op">=</span> GradCAMPlusPlus(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="6cb07044-a760-4e6f-a76a-324a7d0ad0ca" class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>ablationcam <span class="op">=</span> AblationCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="859a36cb-528c-4ebc-80a0-529b5840de51" class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>xgradcam <span class="op">=</span> XGradCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="6f43cede-af65-4062-9269-8627092d38e9" class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>eigencam <span class="op">=</span> EigenCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="00053dfa-c197-4b77-a5b1-0880e1ee54bf" class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>fullgrad <span class="op">=</span> FullGrad(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: target_layers is ignored in FullGrad. All bias layers will be used instead</code></pre>
</div>
</div>
<div id="05ebff54-a4c3-4bd9-b1f0-b05eb0e1f5fe" class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>eigengradcam <span class="op">=</span> EigenGradCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<div id="0f188ffd-4c71-4523-8577-da27c1f1664e" class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> resnet34(pretrained<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>target_layer <span class="op">=</span> [model.layer4[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>layercam <span class="op">=</span> LayerCAM(model<span class="op">=</span>model, target_layers<span class="op">=</span>target_layer)</span></code></pre></div>
</div>
<section id="시도" class="level2">
<h2 class="anchored" data-anchor-id="시도">시도</h2>
<div id="3f585294-83ec-4af0-842e-e558d36e7bc4" class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>x, <span class="op">=</span> first(dls.test_dl([PILImage.create(get_image_files(path)[<span class="dv">20</span>])]))</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x.to(<span class="st">'cpu'</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-72-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="86a69df7-5719-408a-90dc-d924689fbf80" class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>cam_gradcam <span class="op">=</span> gradcam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="30d1af83-efa6-4a63-8fd4-b7c8aed1cb64" class="cell" data-execution_count="188">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>cam_hirescam <span class="op">=</span> hirescam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="92682933-9677-44e4-98ae-01b50d9308a4" class="cell" data-execution_count="189">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>cam_scorecam <span class="op">=</span> scorecam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 32/32 [00:23&lt;00:00,  1.38it/s]</code></pre>
</div>
</div>
<div id="0b64bcf4-81fd-470a-98be-d98b73392df0" class="cell" data-execution_count="190">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>cam_gradcamplusplus <span class="op">=</span> gradcamplusplus(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="d48d0ee7-7acf-4184-8814-67dba76169c9" class="cell" data-execution_count="191">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>cam_ablationcam <span class="op">=</span> ablationcam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 16/16 [00:26&lt;00:00,  1.63s/it]</code></pre>
</div>
</div>
<div id="4da6788c-d9c6-4c44-94fd-aeb923119bb7" class="cell" data-execution_count="192">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>cam_xgradcam <span class="op">=</span> xgradcam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="58244b39-9fc1-4c72-8bf4-65edf60ea9f9" class="cell" data-execution_count="193">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>cam_eigencam <span class="op">=</span> eigencam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="a5111e0e-c42d-4340-96f1-f410ff8c44fb" class="cell" data-execution_count="194">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>cam_fullgrad <span class="op">=</span> fullgrad(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="25692154-2abb-449b-9cee-c257b8ca9580" class="cell" data-execution_count="195">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>cam_eigengradcam <span class="op">=</span> eigengradcam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="d0811096-b227-4114-b325-657cd4a15d07" class="cell" data-execution_count="196">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>cam_layercam <span class="op">=</span> layercam(input_tensor<span class="op">=</span>x,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="0db5f453-9bda-4860-85ee-b4a89f94cc6e" class="cell" data-execution_count="206">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_gradcam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART GradCAM"</span>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_gradcam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART GradCAM"</span>)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-83-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="672d3737-05d7-4ed7-acac-04bd9da9ac9f" class="cell" data-execution_count="207">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_hirescam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART HiResCAM"</span>)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_hirescam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART HiResCAM"</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-84-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f80b8046-5f70-40ae-b7de-1bb4c51b6293" class="cell" data-execution_count="208">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_scorecam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART ScoreCAM"</span>)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_scorecam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART ScoreCAM"</span>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-85-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="efc9e0fe-6ec9-4a90-ac60-caf9d39dd42a" class="cell" data-execution_count="209">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_gradcamplusplus.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART GradCAMPlusPlus"</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_gradcamplusplus.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART GradCAMPlusPlus"</span>)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-86-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="53b6f407-7d2a-43ad-9db7-9e9a94f0d71e" class="cell" data-execution_count="210">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_ablationcam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART AblationCAM"</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_ablationcam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART AblationCAM"</span>)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-87-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ea4de642-47f5-4b60-8b05-0da2322e2707" class="cell" data-execution_count="211">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_xgradcam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART XGradCAM"</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_xgradcam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART XGradCAM"</span>)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-88-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d8b683bb-0889-4a9d-9c2a-5dc2ac489989" class="cell" data-execution_count="212">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_eigencam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART EigenCAM"</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_eigencam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART EigenCAM"</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-89-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3759e40b-2d8d-4b72-b8a5-b87f78565b34" class="cell" data-execution_count="213">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_fullgrad.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART FullGrad"</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_fullgrad.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART FullGrad"</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-90-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9a842618-244c-473e-9180-c5156d9d741b" class="cell" data-execution_count="217">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>ax1.imshow(<span class="op">-</span>cam_layercam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"NORMAL PART LayerCAM"</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_layercam.squeeze(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DISEASE PART LayerCAM"</span>)</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-91-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c540b584-b566-49fd-97d6-2c01d40fe2ef" class="cell" data-execution_count="231">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>fig, ((ax1,ax2,ax3,ax4),</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>      (ax5,ax6,ax7,ax8),</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>      (ax9,ax10,ax11,ax12)) <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">4</span>) </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CALTECH 101 Dataset'</span>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>ax1.imshow(cam_gradcam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"GradCAM"</span>)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_hirescam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"HiResCAM"</span>)</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax3)</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>ax3.imshow(cam_scorecam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"ScoreCAM"</span>)</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax4)</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>ax4.imshow(cam_gradcamplusplus.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">"GradCAMPlusPlus"</span>)</span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax5)</span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>ax5.imshow(cam_ablationcam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>ax5.set_title(<span class="st">"AblationCAM"</span>)</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax6)</span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>ax6.imshow(cam_xgradcam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>ax6.set_title(<span class="st">"XGradCAM"</span>)</span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax7)</span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>ax7.imshow(cam_eigencam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>ax7.set_title(<span class="st">"EigenCAM"</span>)</span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax8)</span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>ax8.imshow(cam_fullgrad.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a>ax8.set_title(<span class="st">"FullGrad"</span>)</span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax9)</span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a>ax9.imshow(cam_eigengradcam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a>ax9.set_title(<span class="st">"EigenGradCAM"</span>)</span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax10)</span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a>ax10.imshow(cam_layercam.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a>ax10.set_title(<span class="st">"LayerCAM"</span>)</span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-46"><a href="#cb114-46" aria-hidden="true" tabindex="-1"></a>(dls.train.decode((x,))[<span class="dv">0</span>].squeeze()<span class="op">*</span><span class="dv">0</span>).show(ax<span class="op">=</span>ax11)</span>
<span id="cb114-47"><a href="#cb114-47" aria-hidden="true" tabindex="-1"></a>(dls.train.decode((x,))[<span class="dv">0</span>].squeeze()<span class="op">*</span><span class="dv">0</span>).show(ax<span class="op">=</span>ax12)</span>
<span id="cb114-48"><a href="#cb114-48" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb114-49"><a href="#cb114-49" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">20</span>)            </span>
<span id="cb114-50"><a href="#cb114-50" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">20</span>)</span>
<span id="cb114-51"><a href="#cb114-51" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb114-52"><a href="#cb114-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-53"><a href="#cb114-53" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_fig_randombox_plt.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb114-54"><a href="#cb114-54" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-92-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1724ffb2-520c-4d65-8ba5-726751212146" class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_fig_randombox_plt.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    fig_randombox_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>fig_randombox_plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-93-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="randombox-image-download" class="level1">
<h1>randombox Image download</h1>
<div id="f0e51b39-eeef-480a-a90d-dbaa0e20f85c" class="cell" data-execution_count="260">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(path.ls())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="260">
<pre><code>[Path('/home/csy/.fastai/data/caltech_101/gerenuk'),
 Path('/home/csy/.fastai/data/caltech_101/ceiling_fan'),
 Path('/home/csy/.fastai/data/caltech_101/electric_guitar'),
 Path('/home/csy/.fastai/data/caltech_101/schooner'),
 Path('/home/csy/.fastai/data/caltech_101/sunflower'),
 Path('/home/csy/.fastai/data/caltech_101/brain'),
 Path('/home/csy/.fastai/data/caltech_101/dolphin'),
 Path('/home/csy/.fastai/data/caltech_101/nautilus'),
 Path('/home/csy/.fastai/data/caltech_101/panda'),
 Path('/home/csy/.fastai/data/caltech_101/chair'),
 Path('/home/csy/.fastai/data/caltech_101/trilobite'),
 Path('/home/csy/.fastai/data/caltech_101/stapler'),
 Path('/home/csy/.fastai/data/caltech_101/beaver'),
 Path('/home/csy/.fastai/data/caltech_101/snoopy'),
 Path('/home/csy/.fastai/data/caltech_101/windsor_chair'),
 Path('/home/csy/.fastai/data/caltech_101/ant'),
 Path('/home/csy/.fastai/data/caltech_101/cougar_face'),
 Path('/home/csy/.fastai/data/caltech_101/octopus'),
 Path('/home/csy/.fastai/data/caltech_101/menorah'),
 Path('/home/csy/.fastai/data/caltech_101/inline_skate'),
 Path('/home/csy/.fastai/data/caltech_101/dollar_bill'),
 Path('/home/csy/.fastai/data/caltech_101/chandelier'),
 Path('/home/csy/.fastai/data/caltech_101/tick'),
 Path('/home/csy/.fastai/data/caltech_101/garfield'),
 Path('/home/csy/.fastai/data/caltech_101/crab'),
 Path('/home/csy/.fastai/data/caltech_101/Faces'),
 Path('/home/csy/.fastai/data/caltech_101/flamingo_head'),
 Path('/home/csy/.fastai/data/caltech_101/car_side'),
 Path('/home/csy/.fastai/data/caltech_101/saxophone'),
 Path('/home/csy/.fastai/data/caltech_101/crocodile_head'),
 Path('/home/csy/.fastai/data/caltech_101/cup'),
 Path('/home/csy/.fastai/data/caltech_101/water_lilly'),
 Path('/home/csy/.fastai/data/caltech_101/starfish'),
 Path('/home/csy/.fastai/data/caltech_101/Motorbikes'),
 Path('/home/csy/.fastai/data/caltech_101/dragonfly'),
 Path('/home/csy/.fastai/data/caltech_101/barrel'),
 Path('/home/csy/.fastai/data/caltech_101/laptop'),
 Path('/home/csy/.fastai/data/caltech_101/flamingo'),
 Path('/home/csy/.fastai/data/caltech_101/wild_cat'),
 Path('/home/csy/.fastai/data/caltech_101/scorpion'),
 Path('/home/csy/.fastai/data/caltech_101/helicopter'),
 Path('/home/csy/.fastai/data/caltech_101/emu'),
 Path('/home/csy/.fastai/data/caltech_101/pyramid'),
 Path('/home/csy/.fastai/data/caltech_101/BACKGROUND_Google'),
 Path('/home/csy/.fastai/data/caltech_101/rooster'),
 Path('/home/csy/.fastai/data/caltech_101/binocular'),
 Path('/home/csy/.fastai/data/caltech_101/llama'),
 Path('/home/csy/.fastai/data/caltech_101/pizza'),
 Path('/home/csy/.fastai/data/caltech_101/wrench'),
 Path('/home/csy/.fastai/data/caltech_101/cellphone'),
 Path('/home/csy/.fastai/data/caltech_101/strawberry'),
 Path('/home/csy/.fastai/data/caltech_101/scissors'),
 Path('/home/csy/.fastai/data/caltech_101/crayfish'),
 Path('/home/csy/.fastai/data/caltech_101/soccer_ball'),
 Path('/home/csy/.fastai/data/caltech_101/wheelchair'),
 Path('/home/csy/.fastai/data/caltech_101/grand_piano'),
 Path('/home/csy/.fastai/data/caltech_101/sea_horse'),
 Path('/home/csy/.fastai/data/caltech_101/lobster'),
 Path('/home/csy/.fastai/data/caltech_101/crocodile'),
 Path('/home/csy/.fastai/data/caltech_101/pigeon'),
 Path('/home/csy/.fastai/data/caltech_101/yin_yang'),
 Path('/home/csy/.fastai/data/caltech_101/umbrella'),
 Path('/home/csy/.fastai/data/caltech_101/lamp'),
 Path('/home/csy/.fastai/data/caltech_101/airplanes'),
 Path('/home/csy/.fastai/data/caltech_101/stop_sign'),
 Path('/home/csy/.fastai/data/caltech_101/kangaroo'),
 Path('/home/csy/.fastai/data/caltech_101/Faces_easy'),
 Path('/home/csy/.fastai/data/caltech_101/lotus'),
 Path('/home/csy/.fastai/data/caltech_101/accordion'),
 Path('/home/csy/.fastai/data/caltech_101/cannon'),
 Path('/home/csy/.fastai/data/caltech_101/watch'),
 Path('/home/csy/.fastai/data/caltech_101/mayfly'),
 Path('/home/csy/.fastai/data/caltech_101/bass'),
 Path('/home/csy/.fastai/data/caltech_101/stegosaurus'),
 Path('/home/csy/.fastai/data/caltech_101/brontosaurus'),
 Path('/home/csy/.fastai/data/caltech_101/euphonium'),
 Path('/home/csy/.fastai/data/caltech_101/elephant'),
 Path('/home/csy/.fastai/data/caltech_101/gramophone'),
 Path('/home/csy/.fastai/data/caltech_101/butterfly'),
 Path('/home/csy/.fastai/data/caltech_101/buddha'),
 Path('/home/csy/.fastai/data/caltech_101/okapi'),
 Path('/home/csy/.fastai/data/caltech_101/Leopards'),
 Path('/home/csy/.fastai/data/caltech_101/ibis'),
 Path('/home/csy/.fastai/data/caltech_101/ewer'),
 Path('/home/csy/.fastai/data/caltech_101/pagoda'),
 Path('/home/csy/.fastai/data/caltech_101/anchor'),
 Path('/home/csy/.fastai/data/caltech_101/camera'),
 Path('/home/csy/.fastai/data/caltech_101/dalmatian'),
 Path('/home/csy/.fastai/data/caltech_101/metronome'),
 Path('/home/csy/.fastai/data/caltech_101/ferry'),
 Path('/home/csy/.fastai/data/caltech_101/headphone'),
 Path('/home/csy/.fastai/data/caltech_101/cougar_body'),
 Path('/home/csy/.fastai/data/caltech_101/hawksbill'),
 Path('/home/csy/.fastai/data/caltech_101/minaret'),
 Path('/home/csy/.fastai/data/caltech_101/mandolin'),
 Path('/home/csy/.fastai/data/caltech_101/bonsai'),
 Path('/home/csy/.fastai/data/caltech_101/rhino'),
 Path('/home/csy/.fastai/data/caltech_101/ketch'),
 Path('/home/csy/.fastai/data/caltech_101/revolver'),
 Path('/home/csy/.fastai/data/caltech_101/joshua_tree'),
 Path('/home/csy/.fastai/data/caltech_101/platypus'),
 Path('/home/csy/.fastai/data/caltech_101/hedgehog')]</code></pre>
</div>
</div>
<div id="a91eb0ac-9625-4a4b-9a1e-a847e22aaf4e" class="cell" data-execution_count="860">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">list</span>(path.ls()))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="860">
<pre><code>5394</code></pre>
</div>
</div>
<div id="3b79994c-c99e-4050-abbc-d7039ce654e3" class="cell" data-execution_count="370">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>temp_img <span class="op">=</span> PILImage.create(get_image_files(path)[<span class="dv">20</span>])</span></code></pre></div>
</div>
<div id="ce84f3f7-d972-4ec0-bdb7-c51c949827a0" class="cell" data-execution_count="371">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>temp_img <span class="op">=</span> temp_img.resize([<span class="dv">512</span>,<span class="dv">512</span>], resample<span class="op">=</span><span class="va">None</span>, box<span class="op">=</span><span class="va">None</span>, reducing_gap<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="b32de4ee-feef-467b-b4f4-6fc23cabd54b" class="cell" data-execution_count="372">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>(temp_w, temp_h) <span class="op">=</span> (temp_img.shape[<span class="dv">0</span>], temp_img.shape[<span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="4900f7ff-5794-43ba-8dfa-fee6f3b2480d" class="cell" data-execution_count="373">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>temp_a <span class="op">=</span> random.uniform(<span class="dv">0</span>, temp_w<span class="op">*</span><span class="fl">0.8</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>temp_b <span class="op">=</span> random.uniform(<span class="dv">0</span>, temp_h<span class="op">*</span><span class="fl">0.3</span>)</span></code></pre></div>
</div>
<div id="2b0cdf1c-6389-4301-aa6e-461d5cb867d9" class="cell" data-execution_count="374">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>temp_shape <span class="op">=</span> [(temp_a, temp_b), (temp_a<span class="op">+</span><span class="dv">200</span>, temp_b<span class="op">+</span><span class="dv">60</span>)]</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>temp_font <span class="op">=</span> ImageFont.truetype(<span class="st">"DejaVuSans.ttf"</span>, <span class="bu">round</span>(temp_h<span class="op">*</span><span class="fl">0.04</span>))</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>temp_name <span class="op">=</span> (<span class="bu">str</span>(<span class="bu">list</span>(path.ls())[<span class="dv">20</span>])<span class="op">+</span><span class="st">'-'</span><span class="op">+</span><span class="bu">str</span>(<span class="dv">20</span>)).split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="st">'.jpg'</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>temp_fname <span class="op">=</span> temp_name.split(<span class="st">'.'</span>)[<span class="dv">0</span>].split(<span class="st">'-'</span>)[<span class="dv">0</span>]</span></code></pre></div>
</div>
<div id="68e69170-ae36-4a9e-b571-96de40134020" class="cell" data-execution_count="375">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>temp_name</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="375">
<pre><code>'dollar_bill-20.jpg'</code></pre>
</div>
</div>
<div id="95a1f696-bab6-46cc-b79d-6e595cbf61da" class="cell" data-execution_count="376">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>temp_fname</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="376">
<pre><code>'dollar_bill'</code></pre>
</div>
</div>
<div id="137ce7c0-95c8-4422-be37-c5af8657ffa5" class="cell" data-execution_count="377">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>temp_img1 <span class="op">=</span> ImageDraw.Draw(temp_img)  </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>temp_img1.rectangle(temp_shape, fill <span class="op">=</span><span class="st">"white"</span>, outline <span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>ImageDraw.Draw(temp_img).text((temp_a<span class="op">+</span><span class="dv">5</span>, temp_b<span class="op">+</span><span class="dv">15</span>), temp_fname, (<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), font<span class="op">=</span>temp_font)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>plt.imshow(temp_img)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>temp_img.save(<span class="st">"caltech_101_random/"</span><span class="op">+</span>temp_name)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-103-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="4b8f25fa-c9bd-4361-9fcb-1b6672226bd1" class="cell" data-execution_count="243">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>get_image_files(path)[<span class="dv">9143</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="243">
<pre><code>Path('/home/csy/.fastai/data/caltech_101/hedgehog/image_0017.jpg')</code></pre>
</div>
</div>
<div id="17ad8c29-f202-4a96-81d6-d9cec4712a9b" class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(path.ls())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="237">
<pre><code>102</code></pre>
</div>
</div>
<div id="83ea21ad-fcc8-492a-8fbb-538a303a6ce3" class="cell" data-execution_count="416">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in range(len(str(list(path.ls())))-1) :</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     img = PILImage.create(get_image_files(path)[i])</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     img = img.resize([512,512], resample=None, box=None, reducing_gap=None)</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     (w, h) = (img.shape[0], img.shape[1])</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     a = random.uniform(0, w*0.8)</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     b = random.uniform(0, h*0.3)</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     shape = [(a, b), (a+200, b+60)]</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     font = ImageFont.truetype("DejaVuSans.ttf", round(h*0.04))</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     name = (os.path.dirname(get_image_files(path)[i]).split('/')[-1]+'-'+str(i)).split('/')[-1] + '.jpg'</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     fname = name.split('.')[0].split('-')[0]</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     img1 = ImageDraw.Draw(img)  </span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     img1.rectangle(shape, fill ="white", outline ="black")</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     ImageDraw.Draw(img).text((a+5, b+15), fname, (0,0,0), font=font)</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     img.save("caltech_101_random/"+name)</span></span></code></pre></div>
</div>
</section>
<section id="randombox" class="level1">
<h1>randombox</h1>
<div id="8967b8ab-b319-44d2-9b11-7e5cd01a1e9c" class="cell" data-execution_count="676">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>path_r<span class="op">=</span>Path(<span class="st">'caltech_101_random'</span>)   <span class="co">#랜덤박스넣은사진</span></span></code></pre></div>
</div>
<div id="e501233c-7ec2-4fd2-a2f6-45f8e4fd0403" class="cell" data-execution_count="677">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>path_r.ls()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="677">
<pre><code>(#5394) [Path('caltech_101_random/Motorbikes-2934.jpg'),Path('caltech_101_random/beaver-782.jpg'),Path('caltech_101_random/Motorbikes-2975.jpg'),Path('caltech_101_random/beaver-796.jpg'),Path('caltech_101_random/BACKGROUND_Google-3983.jpg'),Path('caltech_101_random/Motorbikes-2599.jpg'),Path('caltech_101_random/laptop-3308.jpg'),Path('caltech_101_random/airplanes-5324.jpg'),Path('caltech_101_random/airplanes-5329.jpg'),Path('caltech_101_random/flamingo_head-1941.jpg')...]</code></pre>
</div>
</div>
<div id="23e3cb3d-e2ae-49a5-9aa0-0f60cf44ce66" class="cell" data-execution_count="678">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>files_r<span class="op">=</span>get_image_files(path_r)</span></code></pre></div>
</div>
<div id="533261b8-1ba2-467a-9e6e-577809236c9b" class="cell" data-execution_count="679">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label_func(f):</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f[<span class="dv">0</span>].split(<span class="st">'-'</span>)[<span class="dv">0</span>]</span></code></pre></div>
</div>
<div id="82c820ab-2e16-4e1a-b583-5779fe0bcb69" class="cell" data-execution_count="680">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>dls_r<span class="op">=</span>ImageDataLoaders.from_name_func(path_r,files,label_func,item_tfms<span class="op">=</span>Resize(<span class="dv">512</span>)) </span></code></pre></div>
</div>
<section id="학습" class="level4">
<h4 class="anchored" data-anchor-id="학습">(2) 학습</h4>
<div id="f6f2f086-1301-4c76-81bc-32a4822d0bf2" class="cell" data-outputid="3c87c3dd-6d54-492e-c9b9-5cd814d5b23b" data-execution_count="681">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>lrnr_r<span class="op">=</span>cnn_learner(dls_r,resnet34,metrics<span class="op">=</span>error_rate)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>lrnr_r.fine_tune(<span class="dv">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>2.194400</td>
<td>0.814425</td>
<td>0.234694</td>
<td>00:30</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.633236</td>
<td>0.386290</td>
<td>0.114100</td>
<td>00:36</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="97e9f2b9-1afe-47bb-9bac-14c002e02cdb" class="cell" data-execution_count="682">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>net1_r<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>]</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>net2_r<span class="op">=</span>lrnr_r.model[<span class="dv">1</span>] </span></code></pre></div>
</div>
<div id="2712bbbe-4bf7-4432-a616-03e5486a8302" class="cell" data-execution_count="683">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>net2_r</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="683">
<pre><code>Sequential(
  (0): AdaptiveConcatPool2d(
    (ap): AdaptiveAvgPool2d(output_size=1)
    (mp): AdaptiveMaxPool2d(output_size=1)
  )
  (1): fastai.layers.Flatten(full=False)
  (2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (3): Dropout(p=0.25, inplace=False)
  (4): Linear(in_features=1024, out_features=512, bias=False)
  (5): ReLU(inplace=True)
  (6): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (7): Dropout(p=0.5, inplace=False)
  (8): Linear(in_features=512, out_features=23, bias=False)
)</code></pre>
</div>
</div>
<div id="deb8473e-d7b1-4284-9580-4af959f887e2" class="cell" data-execution_count="684">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>net2_r <span class="op">=</span> torch.nn.Sequential(</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    torch.nn.AdaptiveAvgPool2d(output_size<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    torch.nn.Flatten(),</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    torch.nn.Linear(<span class="dv">512</span>,out_features<span class="op">=</span><span class="dv">23</span>,bias<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
</div>
<div id="aa903376-d623-4f70-97ee-569e4b66a354" class="cell" data-execution_count="685">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>net_r<span class="op">=</span>torch.nn.Sequential(net1_r,net2_r)</span></code></pre></div>
</div>
<div id="13680377-4c88-460b-aeca-ea77a134eb4a" class="cell" data-execution_count="686">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>lrnr2_r<span class="op">=</span>Learner(dls_r,net_r,metrics<span class="op">=</span>accuracy) </span></code></pre></div>
</div>
<div id="12bc4ab4-5514-402f-beef-d078de570945" class="cell" data-execution_count="687">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>lrnr2_r.fine_tune(<span class="dv">5</span>) </span></code></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.990693</td>
<td>7.214967</td>
<td>0.175325</td>
<td>00:36</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.191813</td>
<td>0.626072</td>
<td>0.789425</td>
<td>00:36</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.138365</td>
<td>0.371003</td>
<td>0.892393</td>
<td>00:36</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.059181</td>
<td>0.026200</td>
<td>0.996289</td>
<td>00:36</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.019740</td>
<td>0.011075</td>
<td>0.997217</td>
<td>00:36</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.006568</td>
<td>0.010148</td>
<td>0.997217</td>
<td>00:36</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
</section>
<section id="step-by-step" class="level1">
<h1>Step by step</h1>
<div id="afe6f29f-c8f0-4c2e-b8ec-887526a96884" class="cell" data-execution_count="688">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>x_r, <span class="op">=</span> first(dls.test_dl([PILImage.create(get_image_files(path_r)[<span class="dv">532</span>])]))</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-119-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2cb56d9b-ba8d-4a51-b817-ba5d6ff879af" class="cell" data-execution_count="692">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>camimg_r <span class="op">=</span> torch.einsum(<span class="st">'ij,jkl -&gt; ikl'</span>, net2_r[<span class="dv">2</span>].weight, net1_r(x_r).squeeze())</span></code></pre></div>
</div>
<div id="789802ad-2718-418d-894c-798a55cc0f65" class="cell" data-execution_count="695">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>ebayesthresh <span class="op">=</span> importr(<span class="st">'EbayesThresh'</span>).ebayesthresh</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>power_threshed<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg_r[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>ybar_threshed <span class="op">=</span> np.where(power_threshed<span class="op">&gt;</span><span class="dv">20</span>,torch.tensor(camimg_r[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)).cpu(),<span class="dv">0</span>)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>ybar_threshed <span class="op">=</span> torch.tensor(ybar_threshed.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>power_threshed2<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg_r[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>ybar_threshed2 <span class="op">=</span> np.where(power_threshed2<span class="op">&gt;</span><span class="dv">20</span>,torch.tensor(camimg_r[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)).cpu(),<span class="dv">0</span>)</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>ybar_threshed2 <span class="op">=</span> torch.tensor(ybar_threshed2.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed=np.array(ebayesthresh(FloatVector(torch.tensor(camimg_r[0].detach().reshape(-1))**2)))
&lt;ipython-input-695-1fb834e23ce9&gt;:4: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed = np.where(power_threshed&gt;20,torch.tensor(camimg_r[0].detach().reshape(-1)).cpu(),0)
&lt;ipython-input-695-1fb834e23ce9&gt;:7: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed2=np.array(ebayesthresh(FloatVector(torch.tensor(camimg_r[1].detach().reshape(-1))**2)))
&lt;ipython-input-695-1fb834e23ce9&gt;:8: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed2 = np.where(power_threshed2&gt;20,torch.tensor(camimg_r[1].detach().reshape(-1)).cpu(),0)</code></pre>
</div>
</div>
<div id="9672832c-f6e2-4240-be68-2a31b3c8d4f3" class="cell" data-execution_count="696">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2,ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>) </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Input image"</span>)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>ax2.imshow((ybar_threshed).to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ax2.set_title("CAT PART")</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax3)</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>ax3.imshow((ybar_threshed2).to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ax3.set_title("DOG PART")</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">12</span>)            </span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">12</span>)</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-122-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>판단 근거가 강할 수록 파란색 -&gt; 보라색</li>
</ul>
<section id="mode-1-1" class="level2">
<h2 class="anchored" data-anchor-id="mode-1-1">mode 1</h2>
<div id="08e5e795-037e-4beb-8b7f-a821c8f78158" class="cell" data-execution_count="697">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test=camimg_o[0]-torch.min(camimg_o[0])</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>A1<span class="op">=</span>torch.exp(<span class="op">-</span><span class="fl">0.05</span><span class="op">*</span>(ybar_threshed))</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> A1</span></code></pre></div>
</div>
<div id="9accce1f-9415-4fda-8823-0a470c531219" class="cell" data-execution_count="698">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(A2.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1 WEIGHTT"</span>)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(A1.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES WEIGHT"</span>)</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-124-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="522c6c45-19e3-4376-a9a5-b6691e1edc9b" class="cell" data-execution_count="706">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mode 1 res</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>np.array(A1.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>Y1<span class="op">=</span>torch.Tensor(cv2.resize(X1,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>x1<span class="op">=</span>x_r.squeeze().to(<span class="st">'cpu'</span>)<span class="op">*</span>Y1<span class="op">-</span>torch.<span class="bu">min</span>(x_r.squeeze().to(<span class="st">'cpu'</span>))<span class="op">*</span>Y1</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mode 1</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>X12<span class="op">=</span>np.array(A2.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>Y12<span class="op">=</span>torch.Tensor(cv2.resize(X12,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>x12<span class="op">=</span>x_r.squeeze().to(<span class="st">'cpu'</span>)<span class="op">*</span>Y12<span class="op">-</span>torch.<span class="bu">min</span>(x_r.squeeze().to(<span class="st">'cpu'</span>))<span class="op">*</span>Y12</span></code></pre></div>
</div>
<p><code>-</code> 1st CAM 분리</p>
<div id="cb3e4842-d329-4837-9af0-c8127c094bac" class="cell" data-execution_count="857">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"ORIGINAL"</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">4</span>)            </span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">4</span>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">1.5</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.5</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE1_res</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES"</span>)</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-126-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-126-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="81319fad-57c2-4b94-ae37-7fa92cd445bf" class="cell" data-execution_count="720">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> x1.reshape(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">512</span>,<span class="dv">512</span>)</span></code></pre></div>
</div>
<div id="1f7118be-7bbb-484d-8950-eea2706a2f63" class="cell" data-execution_count="722">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>net1_r.to(<span class="st">'cpu'</span>)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>net2_r.to(<span class="st">'cpu'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="722">
<pre><code>Sequential(
  (0): AdaptiveAvgPool2d(output_size=1)
  (1): Flatten(start_dim=1, end_dim=-1)
  (2): Linear(in_features=512, out_features=23, bias=False)
)</code></pre>
</div>
</div>
<div id="9478ab19-698a-452c-a6f8-0724057f99fc" class="cell" data-execution_count="723">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>camimg1_r <span class="op">=</span> torch.einsum(<span class="st">'ij,jkl -&gt; ikl'</span>, net2_r[<span class="dv">2</span>].weight, net1_r(x1).squeeze())</span></code></pre></div>
</div>
<div id="6f4cbc92-68ff-4987-bca2-6f800bc91438" class="cell" data-execution_count="724">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>power_threshed3<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg1_r[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>ybar_threshed3 <span class="op">=</span> np.where(power_threshed3<span class="op">&gt;</span><span class="dv">20</span>,torch.tensor(camimg1_r[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>ybar_threshed3 <span class="op">=</span> torch.tensor(ybar_threshed3.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>power_threshed4<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg1_r[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>ybar_threshed4 <span class="op">=</span> np.where(power_threshed4<span class="op">&gt;</span><span class="dv">20</span>,torch.tensor(camimg1_r[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>ybar_threshed4 <span class="op">=</span> torch.tensor(ybar_threshed4.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed3=np.array(ebayesthresh(FloatVector(torch.tensor(camimg1_r[0].detach().reshape(-1))**2)))
&lt;ipython-input-724-c83bfb4d70dd&gt;:2: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed3 = np.where(power_threshed3&gt;20,torch.tensor(camimg1_r[0].detach().reshape(-1)),0)
&lt;ipython-input-724-c83bfb4d70dd&gt;:5: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed4=np.array(ebayesthresh(FloatVector(torch.tensor(camimg1_r[1].detach().reshape(-1))**2)))
&lt;ipython-input-724-c83bfb4d70dd&gt;:6: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed4 = np.where(power_threshed4&gt;20,torch.tensor(camimg1_r[1].detach().reshape(-1)),0)</code></pre>
</div>
</div>
<p><code>-</code> mode1 res</p>
<div id="2cdeaef2-9271-4cca-aaa9-75f90be8e2ca" class="cell" data-execution_count="726">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.25</span>).squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed3,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"CAT PART"</span>)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.25</span>).squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed4,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DOG PART"</span>)</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-131-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><code>-</code> 첫번째 CAM 결과와 비교</p>
<div id="f4e9e2bd-9976-406b-8a8b-9bb76c144dce" class="cell" data-execution_count="727">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"1ST CAM"</span>)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed3,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"2ND CAM"</span>)</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-132-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><code>-</code> 2nd CAM 분리</p>
<div id="277e5ede-456c-4947-9a11-0c17e2868e41" class="cell" data-execution_count="728">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test1=camimg1[0]-torch.min(camimg1[0])</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>A3 <span class="op">=</span> torch.exp(<span class="op">-</span><span class="fl">0.05</span><span class="op">*</span>(ybar_threshed3))</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>A4 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> A3</span></code></pre></div>
</div>
<div id="663ae91e-5dd1-4e46-bdaf-a38f52f08db5" class="cell" data-execution_count="729">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>x1.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x1,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>ax1.imshow(A3.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE2 RES WEIGHT"</span>)</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>x1.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x1,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>ax2.imshow(A4.data.to(<span class="st">"cpu"</span>).detach(),alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE2 WEIGHT"</span>)</span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-134-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a6c282da-b3c3-44c6-9134-b2ba7790f1f7" class="cell" data-execution_count="730">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>X2<span class="op">=</span>np.array(A3.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>Y2<span class="op">=</span>torch.Tensor(cv2.resize(X2,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>x2<span class="op">=</span>(x1)<span class="op">*</span>Y2<span class="op">-</span>torch.<span class="bu">min</span>((x1)<span class="op">*</span>Y2)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>X22<span class="op">=</span>np.array(A4.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>Y22<span class="op">=</span>torch.Tensor(cv2.resize(X22,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>x22<span class="op">=</span>(x1)<span class="op">*</span>Y22<span class="op">-</span>torch.<span class="bu">min</span>((x1)<span class="op">*</span>Y22)</span></code></pre></div>
</div>
<div id="9c15ed10-77ca-4e7a-aa42-5c21c6585a52" class="cell" data-execution_count="858">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"ORIGINAL"</span>)</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">4</span>)            </span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">4</span>)</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">1.5</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.5</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE1_res</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES"</span>)</span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x22<span class="op">+</span><span class="dv">1</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE2</span></span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a>(x2<span class="op">*</span><span class="fl">0.5</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE2_res</span></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE2"</span>)</span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE2 RES"</span>)</span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb170-24"><a href="#cb170-24" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-136-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-136-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-136-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e08b35a8-2947-4697-b1ab-7eb277cd1af4" class="cell" data-execution_count="742">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> x2.reshape(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">512</span>,<span class="dv">512</span>)</span></code></pre></div>
</div>
<div id="3d3b9e9e-7752-4335-af2d-7af979a84bfd" class="cell" data-execution_count="743">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>net1_r.to(<span class="st">'cpu'</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>net2_r.to(<span class="st">'cpu'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="743">
<pre><code>Sequential(
  (0): AdaptiveAvgPool2d(output_size=1)
  (1): Flatten(start_dim=1, end_dim=-1)
  (2): Linear(in_features=512, out_features=23, bias=False)
)</code></pre>
</div>
</div>
<div id="66eaf01b-7b4a-48c9-b133-ac39151610a2" class="cell" data-execution_count="745">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>camimg2_r <span class="op">=</span> torch.einsum(<span class="st">'ij,jkl -&gt; ikl'</span>, net2_r[<span class="dv">2</span>].weight, net1_r(x2).squeeze())</span></code></pre></div>
</div>
<div id="b4e3b122-8309-42ed-bb28-ce20df4d0d7c" class="cell" data-execution_count="746">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>power_threshed5<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg2_r[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>ybar_threshed5 <span class="op">=</span> np.where(power_threshed5<span class="op">&gt;</span><span class="dv">10</span>,torch.tensor(camimg2_r[<span class="dv">0</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>ybar_threshed5 <span class="op">=</span> torch.tensor(ybar_threshed5.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>power_threshed6<span class="op">=</span>np.array(ebayesthresh(FloatVector(torch.tensor(camimg2_r[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>ybar_threshed6 <span class="op">=</span> np.where(power_threshed6<span class="op">&gt;</span><span class="dv">10</span>,torch.tensor(camimg2_r[<span class="dv">1</span>].detach().reshape(<span class="op">-</span><span class="dv">1</span>)),<span class="dv">0</span>)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>ybar_threshed6 <span class="op">=</span> torch.tensor(ybar_threshed6.reshape(<span class="dv">16</span>,<span class="dv">16</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed5=np.array(ebayesthresh(FloatVector(torch.tensor(camimg2_r[0].detach().reshape(-1))**2)))
&lt;ipython-input-746-f3a70d6c47ba&gt;:2: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed5 = np.where(power_threshed5&gt;10,torch.tensor(camimg2_r[0].detach().reshape(-1)),0)
&lt;ipython-input-746-f3a70d6c47ba&gt;:5: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  power_threshed6=np.array(ebayesthresh(FloatVector(torch.tensor(camimg2_r[1].detach().reshape(-1))**2)))
&lt;ipython-input-746-f3a70d6c47ba&gt;:6: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  ybar_threshed6 = np.where(power_threshed6&gt;10,torch.tensor(camimg2_r[1].detach().reshape(-1)),0)</code></pre>
</div>
</div>
<p><code>-</code> mode2 res 에 CAM 결과 올리기</p>
<div id="6dce5e1d-f48c-43b8-bd96-19412eb91dc4" class="cell" data-execution_count="747">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed5,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"CAT PART"</span>)</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed6,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DOG PART"</span>)</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-141-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1c093553-6424-4db2-9692-686079fda489" class="cell" data-execution_count="748">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2,ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>) </span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"1ST CAM"</span>)</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed3,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"2ND CAM"</span>)</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax3)</span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>ax3.imshow(ybar_threshed5,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"3RD CAM"</span>)</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">12</span>)            </span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">12</span>)</span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-142-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mode-3-만들기-1" class="level2">
<h2 class="anchored" data-anchor-id="mode-3-만들기-1">mode 3 만들기</h2>
<div id="fffc143f-a848-4880-9f22-74264c600330" class="cell" data-execution_count="657">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test2=camimg2[0]-torch.min(camimg2[0])</span></span></code></pre></div>
</div>
<div id="a36c950d-682d-487d-ade2-80d4dc208b99" class="cell" data-execution_count="749">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>A5 <span class="op">=</span> torch.exp(<span class="op">-</span><span class="fl">0.05</span><span class="op">*</span>(ybar_threshed5))</span></code></pre></div>
</div>
<div id="1b742467-6975-4bce-aada-29196d498407" class="cell" data-execution_count="750">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>A6 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> A5</span></code></pre></div>
</div>
<div id="70940c67-d777-4a92-8964-df93dc3c6185" class="cell" data-execution_count="751">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>ax1.imshow(ybar_threshed5,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"CAT PART"</span>)</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>x2.squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>ax2.imshow(ybar_threshed6,alpha<span class="op">=</span><span class="fl">0.5</span>,extent<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">511</span>,<span class="dv">511</span>,<span class="dv">0</span>),interpolation<span class="op">=</span><span class="st">'bilinear'</span>,cmap<span class="op">=</span><span class="st">'cool'</span>)</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"DOG PART"</span>)</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-146-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="faa3f5b1-a008-47df-91be-74312e1c9661" class="cell" data-execution_count="752">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mode 3 res</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>X3<span class="op">=</span>np.array(A5.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>Y3<span class="op">=</span>torch.Tensor(cv2.resize(X3,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>x2<span class="op">*</span>Y3<span class="op">-</span>torch.<span class="bu">min</span>(x2<span class="op">*</span>Y3)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mode 3</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>X32<span class="op">=</span>np.array(A6.to(<span class="st">"cpu"</span>).detach(),dtype<span class="op">=</span>np.float32)</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>Y32<span class="op">=</span>torch.Tensor(cv2.resize(X32,(<span class="dv">512</span>,<span class="dv">512</span>),interpolation<span class="op">=</span>cv2.INTER_LINEAR))</span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>x32<span class="op">=</span>x2<span class="op">*</span>Y32<span class="op">-</span>torch.<span class="bu">min</span>(x2<span class="op">*</span>Y32)</span></code></pre></div>
</div>
<div id="dccfb139-83db-41dd-b6f4-aaf8ec586e64" class="cell" data-execution_count="846">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"ORIGINAL"</span>)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">4</span>)            </span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">4</span>)</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt1.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">1.5</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>(x1<span class="op">*</span><span class="fl">0.5</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE1_res</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE1 RES"</span>)</span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt2.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb187-24"><a href="#cb187-24" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x22<span class="op">+</span><span class="dv">1</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE2</span></span>
<span id="cb187-25"><a href="#cb187-25" aria-hidden="true" tabindex="-1"></a>(x2<span class="op">*</span><span class="fl">0.5</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE2_res</span></span>
<span id="cb187-26"><a href="#cb187-26" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE2"</span>)</span>
<span id="cb187-27"><a href="#cb187-27" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE2 RES"</span>)</span>
<span id="cb187-28"><a href="#cb187-28" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb187-29"><a href="#cb187-29" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb187-30"><a href="#cb187-30" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb187-31"><a href="#cb187-31" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt3.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb187-32"><a href="#cb187-32" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span>
<span id="cb187-33"><a href="#cb187-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-34"><a href="#cb187-34" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb187-35"><a href="#cb187-35" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb187-36"><a href="#cb187-36" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>x32<span class="op">+</span><span class="dv">1</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE3</span></span>
<span id="cb187-37"><a href="#cb187-37" aria-hidden="true" tabindex="-1"></a>(x3<span class="op">*</span><span class="fl">0.5</span>).squeeze().show(ax<span class="op">=</span>ax2)  <span class="co">#MODE3_res</span></span>
<span id="cb187-38"><a href="#cb187-38" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE3"</span>)</span>
<span id="cb187-39"><a href="#cb187-39" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"MODE3 RES"</span>)</span>
<span id="cb187-40"><a href="#cb187-40" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb187-41"><a href="#cb187-41" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb187-42"><a href="#cb187-42" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb187-43"><a href="#cb187-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-44"><a href="#cb187-44" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt4.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb187-45"><a href="#cb187-45" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-148-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-148-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-148-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-148-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="62f1d78d-08f3-472f-867b-81bab3528fc7" class="cell" data-execution_count="847">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-149-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="401f06f4-be7c-487b-82ed-3850f8625e55" class="cell" data-execution_count="848">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt2.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-150-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="25c83b16-7225-41ff-aa32-914e9aca4cab" class="cell" data-execution_count="849">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt3.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-151-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="042b04b0-1a01-4ab7-b838-7e5fd11920ad" class="cell" data-execution_count="850">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt4.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-152-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1ec9e631-47e6-4136-bcfa-bc5957d21517" class="cell" data-execution_count="851">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">1.5</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1"</span>)</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt_mode1.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-153-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1b526f75-24c7-47e7-a797-057c16d559f1" class="cell" data-execution_count="852">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt_mode1.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt_mode1 <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt_mode1)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-154-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e3cbfae8-a658-4683-b052-bb773650ec9c" class="cell" data-execution_count="853">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">1.5</span> <span class="op">+</span> <span class="op">-</span>x22<span class="op">+</span><span class="dv">1</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1+MODE2</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1+MODE2"</span>)</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt_mode2.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-155-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2050dadb-3c39-4b3e-9e0d-263be91c3957" class="cell" data-execution_count="854">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt_mode2.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt_mode2 <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt_mode2)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-156-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3ed94999-c6fa-425c-ae79-85558b4f43fa" class="cell" data-execution_count="855">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>) </span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>(x12<span class="op">*-</span><span class="fl">1.5</span> <span class="op">+</span> <span class="op">-</span>x22<span class="op">+</span><span class="dv">1</span> <span class="op">+</span> <span class="op">-</span>x32<span class="op">+</span><span class="dv">1</span>).squeeze().show(ax<span class="op">=</span>ax1)  <span class="co">#MODE1+MODE2+MODE3</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"MODE1+MODE2+MODE3"</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">8</span>)            </span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">8</span>)</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt_mode3.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-157-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="dd132f6e-0189-48ad-9425-e45704d110e5" class="cell" data-execution_count="856">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_hcam_cat_plt_mode3.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>    hcam_cat_plt_mode3 <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>plt.show(hcam_cat_plt_mode3)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-158-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="randombox-other-methods" class="level1">
<h1>Randombox Other Methods</h1>
<div id="a270653d-2e90-4c38-b6a3-bc2775c85ca1" class="cell" data-execution_count="775">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>x_r <span class="op">=</span> x_r.to(<span class="st">'cpu'</span>)</span></code></pre></div>
</div>
</section>
<section id="gradcam" class="level1">
<h1>GradCAM</h1>
<div id="39b9f64a-7fce-467b-99e3-b887b1dc5cf7" class="cell" data-execution_count="777">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>gradcam_randombox <span class="op">=</span> GradCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="490d183a-816e-4d0a-89a7-c5c71b24b8ae" class="cell" data-execution_count="778">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>cam_gradcam_randombox <span class="op">=</span> gradcam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="e168be5e-4238-4690-8bc7-c1dfb16eb2ae" class="cell" data-execution_count="779">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_gradcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-162-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hirescam" class="level1">
<h1>HiResCAM</h1>
<div id="19d40be5-ec5f-44ab-8b9c-d003d6082e58" class="cell" data-execution_count="780">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>hirescam_randombox <span class="op">=</span> HiResCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="a62d7663-680a-417b-92e2-1a228ff77d25" class="cell" data-execution_count="781">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>cam_hirescam_randombox <span class="op">=</span> hirescam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="ea63a0b6-a878-49e0-a79a-637e4a145a94" class="cell" data-execution_count="782">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_hirescam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-165-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scorecam" class="level1">
<h1>ScoreCAM</h1>
<div id="6622d552-6152-44f2-8176-7cb0e7e40b1d" class="cell" data-execution_count="783">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>scorecam_randombox <span class="op">=</span> ScoreCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="905c7611-af88-4347-a486-1f0e72b1d900" class="cell" data-execution_count="784">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>cam_scorecam_randombox <span class="op">=</span> scorecam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 32/32 [00:24&lt;00:00,  1.30it/s]
100%|██████████| 32/32 [00:24&lt;00:00,  1.30it/s]
100%|██████████| 32/32 [00:24&lt;00:00,  1.31it/s]</code></pre>
</div>
</div>
<div id="f21d15dc-b2b7-4d70-833c-10e1c5a73f70" class="cell" data-execution_count="785">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_scorecam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-168-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gradcamplusplus" class="level1">
<h1>GradCAMPlusPlus</h1>
<div id="ca5ffb36-13c1-48f5-84a6-3321cb259b9f" class="cell" data-execution_count="786">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>gradcamplusplus_randombox <span class="op">=</span> GradCAMPlusPlus(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="f0f90ad2-841b-466c-8e1e-4f7011e83fdd" class="cell" data-execution_count="787">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>cam_gradcamplusplus_randombox <span class="op">=</span> gradcamplusplus_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="4344aced-d851-4d3b-bf33-a0aac079c9a7" class="cell" data-execution_count="788">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_gradcamplusplus_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-171-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ablationcam" class="level1">
<h1>AblationCAM</h1>
<div id="8073a275-2053-4f8e-9990-5770fe453caf" class="cell" data-execution_count="789">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>ablationcam_randombox <span class="op">=</span> AblationCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="13edac99-143c-4632-980b-5fa256e50e62" class="cell" data-execution_count="790">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>cam_ablationcam_randombox <span class="op">=</span> ablationcam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 16/16 [00:26&lt;00:00,  1.64s/it]
100%|██████████| 16/16 [00:25&lt;00:00,  1.58s/it]
100%|██████████| 16/16 [00:25&lt;00:00,  1.57s/it]</code></pre>
</div>
</div>
<div id="ae93c672-efdf-45f5-88a7-c34c72e0d795" class="cell" data-execution_count="791">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_ablationcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-174-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="xgradcam" class="level1">
<h1>XGradCAM</h1>
<div id="b87a4a8a-dd0d-4393-8453-daf1b35bfbb3" class="cell" data-execution_count="792">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>xgradcam_randombox <span class="op">=</span> XGradCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="48e4e1c6-e7ba-4cc0-a854-a7ae145b0959" class="cell" data-execution_count="793">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>cam_xgradcam_randombox <span class="op">=</span> xgradcam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="3cb446bc-d299-4bd0-a401-54acc5cf6b2b" class="cell" data-execution_count="794">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_xgradcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-177-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="eigencam" class="level1">
<h1>EigenCAM</h1>
<div id="a5ed61eb-055f-4ffd-9d89-4abf447ef9b9" class="cell" data-execution_count="795">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>eigencam_randombox <span class="op">=</span> EigenCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="b77008c2-f45b-47f2-874f-bd18e0973250" class="cell" data-execution_count="796">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>cam_eigencam_randombox <span class="op">=</span> eigencam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="200dbb59-51c2-4c9f-bc38-70c4eceed254" class="cell" data-execution_count="797">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_eigencam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-180-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fullgrad" class="level1">
<h1>FullGrad</h1>
<div id="5aff4a0e-4710-4316-bc3e-330b9f67fe15" class="cell" data-execution_count="798">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>fullgrad_randombox <span class="op">=</span> FullGrad(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: target_layers is ignored in FullGrad. All bias layers will be used instead</code></pre>
</div>
</div>
<div id="a7eb4384-cc18-4421-b559-5b05316848b3" class="cell" data-execution_count="799">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>cam_fullgrad_randombox <span class="op">=</span> fullgrad_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="b8c8090f-098e-4cf6-a33b-60b3e20a3d15" class="cell" data-execution_count="800">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_fullgrad_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-183-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="eigengradcam" class="level1">
<h1>EigenGradCAM</h1>
<div id="1837c9c6-fe90-49e6-81e9-d0108aa00fb3" class="cell" data-execution_count="801">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>eigengradcam_randombox <span class="op">=</span> EigenGradCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="1ff1f875-2450-46e7-85f3-7270867cfcdb" class="cell" data-execution_count="802">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>cam_eigengradcam_randombox <span class="op">=</span> eigengradcam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="7cd1a45f-10fe-4acb-ae38-659b2a8d2b54" class="cell" data-execution_count="803">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_eigengradcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-186-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="layercam" class="level1">
<h1>LayerCAM</h1>
<div id="5d26e160-4dd2-49b7-8fb3-339a8399e47d" class="cell" data-execution_count="804">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>layercam_randombox <span class="op">=</span> LayerCAM(model<span class="op">=</span>lrnr_r.model.to(<span class="st">'cpu'</span>), target_layers<span class="op">=</span>lrnr_r.model[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div>
</div>
<div id="8d1e71b5-6ed4-4af8-87d0-fcdbd2e978d4" class="cell" data-execution_count="805">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>cam_layercam_randombox <span class="op">=</span> layercam_randombox(input_tensor<span class="op">=</span>x_r,targets<span class="op">=</span><span class="va">None</span>)</span></code></pre></div>
</div>
<div id="720b3286-6acc-40ae-8f94-196f1680d5c7" class="cell" data-execution_count="806">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show()</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(cam_layercam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-189-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="figure_randombox" class="level2">
<h2 class="anchored" data-anchor-id="figure_randombox">Figure_Randombox</h2>
<div id="328537ee-169f-478f-a38e-fc5afdde175e" class="cell" data-execution_count="812">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>fig, ((ax1,ax2,ax3,ax4),</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>      (ax5,ax6,ax7,ax8),</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>      (ax9,ax10,ax11,ax12)) <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">4</span>) </span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Randombox'</span>)</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax1)</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>ax1.imshow(cam_gradcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"GradCAM"</span>)</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax2)</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>ax2.imshow(cam_hirescam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"HiResCAM"</span>)</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax3)</span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>ax3.imshow(cam_scorecam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"ScoreCAM"</span>)</span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax4)</span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>ax4.imshow(cam_gradcamplusplus_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">"GradCAMPlusPlus"</span>)</span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax5)</span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>ax5.imshow(cam_ablationcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>ax5.set_title(<span class="st">"AblationCAM"</span>)</span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax6)</span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a>ax6.imshow(cam_xgradcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-28"><a href="#cb235-28" aria-hidden="true" tabindex="-1"></a>ax6.set_title(<span class="st">"XGradCAM"</span>)</span>
<span id="cb235-29"><a href="#cb235-29" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-30"><a href="#cb235-30" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax7)</span>
<span id="cb235-31"><a href="#cb235-31" aria-hidden="true" tabindex="-1"></a>ax7.imshow(cam_eigencam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-32"><a href="#cb235-32" aria-hidden="true" tabindex="-1"></a>ax7.set_title(<span class="st">"EigenCAM"</span>)</span>
<span id="cb235-33"><a href="#cb235-33" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-34"><a href="#cb235-34" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax8)</span>
<span id="cb235-35"><a href="#cb235-35" aria-hidden="true" tabindex="-1"></a>ax8.imshow(cam_fullgrad_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-36"><a href="#cb235-36" aria-hidden="true" tabindex="-1"></a>ax8.set_title(<span class="st">"FullGrad"</span>)</span>
<span id="cb235-37"><a href="#cb235-37" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-38"><a href="#cb235-38" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax9)</span>
<span id="cb235-39"><a href="#cb235-39" aria-hidden="true" tabindex="-1"></a>ax9.imshow(cam_eigengradcam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-40"><a href="#cb235-40" aria-hidden="true" tabindex="-1"></a>ax9.set_title(<span class="st">"EigenGradCAM"</span>)</span>
<span id="cb235-41"><a href="#cb235-41" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-42"><a href="#cb235-42" aria-hidden="true" tabindex="-1"></a>dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze().show(ax<span class="op">=</span>ax10)</span>
<span id="cb235-43"><a href="#cb235-43" aria-hidden="true" tabindex="-1"></a>ax10.imshow(cam_layercam_randombox.squeeze(), alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb235-44"><a href="#cb235-44" aria-hidden="true" tabindex="-1"></a>ax10.set_title(<span class="st">"LayerCAM"</span>)</span>
<span id="cb235-45"><a href="#cb235-45" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-46"><a href="#cb235-46" aria-hidden="true" tabindex="-1"></a>(dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze()<span class="op">*</span><span class="dv">0</span>).show(ax<span class="op">=</span>ax11)</span>
<span id="cb235-47"><a href="#cb235-47" aria-hidden="true" tabindex="-1"></a>(dls.train.decode((x_r,))[<span class="dv">0</span>].squeeze()<span class="op">*</span><span class="dv">0</span>).show(ax<span class="op">=</span>ax12)</span>
<span id="cb235-48"><a href="#cb235-48" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb235-49"><a href="#cb235-49" aria-hidden="true" tabindex="-1"></a>fig.set_figwidth(<span class="dv">20</span>)            </span>
<span id="cb235-50"><a href="#cb235-50" aria-hidden="true" tabindex="-1"></a>fig.set_figheight(<span class="dv">20</span>)</span>
<span id="cb235-51"><a href="#cb235-51" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb235-52"><a href="#cb235-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-53"><a href="#cb235-53" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_fig_randombox_plt.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb235-54"><a href="#cb235-54" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fig, <span class="bu">file</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-190-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f10d2e9c-072d-4039-9bad-c7e79aa1e0bf" class="cell" data-execution_count="813">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'CALTECH_101_random_fig_randombox_plt.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>    fig_randombox_plt <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>fig_randombox_plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2024-01-05-CAM_Dataset1_files/figure-html/cell-191-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>